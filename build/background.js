"use strict";var l=(e=>(e.optimize_article="optimize_article",e.extract_content="extract_content",e.ping="ping",e))(l||{});function h(){return"chrome"in self&&"aiOriginTrial"in self.chrome?self.chrome.aiOriginTrial:"ai"in self?self.ai:null}class u extends Error{}class a extends u{}class g extends u{}function p(e,n){function t(i,o){let s;function r(f){clearTimeout(s),chrome.runtime.lastError?o(new a("Error sending message")):i(f)}chrome.tabs.sendMessage(e.id,n,r),s=setTimeout(o,5e3,new g("Waited too long for response"))}return new Promise(t)}function b(e){function n(t,i){function o(r){chrome.runtime.lastError?i(new a("Error sending message")):t(!0)}function s(r){if(!(r instanceof a)){i(r);return}chrome.scripting.executeScript({target:{tabId:e.id},files:["contentScript.js"]},o)}p(e,{action:l.ping}).then(t).catch(s)}return new Promise(n)}var d=(e=>(e.tab_listener="tab_listener",e))(d||{}),m=(e=>(e.tab_changed="tab_changed",e))(m||{});function I(){chrome.contextMenus.create({id:"optimize-article",title:"Optimize Content",contexts:["page"]}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e))}async function _(){const e=h();if(e)try{const n=await e.languageModel.capabilities(),{available:t}=n;if(t==="readily"){I();return}}catch{}}function w(){chrome.contextMenus.removeAll(_)}chrome.runtime.onInstalled.addListener(w);async function x(e){await b(e),chrome.scripting.insertCSS({target:{tabId:e.id},files:["static/animations.css"]}),chrome.tabs.sendMessage(e.id,{action:l.optimize_article})}function E(e,n){n&&n.id&&e.menuItemId==="optimize-article"&&x(n).catch(console.error)}chrome.contextMenus.onClicked.addListener(E);const c=new Set;async function T(e){const n=await chrome.tabs.get(e.tabId);if(!n||!n.url)return;let t=n.url;const i=new URL(t);i.hash="",t=i.href;function o(s){const r={action:m.tab_changed,payload:{url:t}};s.postMessage(r)}c.forEach(o)}function P(e){function n(){c.delete(e)}c.add(e),e.onDisconnect.addListener(n)}function L(e){e.name===d.tab_listener&&P(e)}chrome.tabs.onActivated.addListener(T);chrome.runtime.onConnect.addListener(L);
