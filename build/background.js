"use strict";var r=(e=>(e.optimize_article="optimize_article",e.extract_content="extract_content",e))(r||{});function u(){return"chrome"in self&&"aiOriginTrial"in self.chrome?self.chrome.aiOriginTrial:"ai"in self?self.ai:null}var c=(e=>(e.tab_listener="tab_listener",e))(c||{}),o=(e=>(e.tab_changed="tab_changed",e))(o||{});function m(){chrome.contextMenus.create({id:"optimize-article",title:"Optimize Content",contexts:["page"]}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e))}async function f(){const e=u();if(e)try{const t=await e.languageModel.capabilities(),{available:n}=t;if(n==="readily"){m();return}}catch{}}function h(){chrome.contextMenus.removeAll(f)}chrome.runtime.onInstalled.addListener(h);function b(e,t){t&&t.id&&e.menuItemId==="optimize-article"&&(chrome.scripting.insertCSS({target:{tabId:t.id},files:["static/animations.css"]}),chrome.tabs.sendMessage(t.id,{action:r.optimize_article}))}chrome.contextMenus.onClicked.addListener(b);const i=new Set;async function g(e){const t=await chrome.tabs.get(e.tabId);if(!t||!t.url)return;let n=t.url;const a=new URL(n);a.hash="",n=a.href;function s(l){const d={action:o.tab_changed,payload:{url:n}};l.postMessage(d)}i.forEach(s)}function _(e){function t(){i.delete(e)}i.add(e),e.onDisconnect.addListener(t)}function p(e){e.name===c.tab_listener&&_(e)}chrome.tabs.onActivated.addListener(g);chrome.runtime.onConnect.addListener(p);
