"use strict";var c=(e=>(e.optimize_article="optimize_article",e.extract_content="extract_content",e))(c||{}),o=(e=>(e.tab_listener="tab_listener",e))(o||{}),r=(e=>(e.tab_changed="tab_changed",e))(r||{});function m(){chrome.contextMenus.create({id:"optimize-article",title:"Optimize Content",contexts:["page"]}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error(e))}async function u(){if("ai"in self)try{const e=await self.ai.languageModel.capabilities(),{available:t}=e;if(t==="readily"){m();return}}catch{}}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.removeAll(()=>{u()})});chrome.contextMenus.onClicked.addListener((e,t)=>{t&&t.id&&e.menuItemId==="optimize-article"&&(chrome.scripting.insertCSS({target:{tabId:t.id},files:["static/animations.css"]}),chrome.tabs.sendMessage(t.id,{action:c.optimize_article}))});const i=new Set;async function h(e){const t=await chrome.tabs.get(e.tabId);if(!t||!t.url)return;let n=t.url;const a=new URL(n);a.hash="",n=a.href;function s(l){const d={action:r.tab_changed,payload:{url:n}};l.postMessage(d)}i.forEach(s)}chrome.tabs.onActivated.addListener(h);chrome.runtime.onConnect.addListener(function(t){t.name===o.tab_listener&&(i.add(t),t.onDisconnect.addListener(function(){i.delete(t)}))});
